/*!https://github.com/shohei909/vilog.js |MIT Lisense*/
!function(t,r){"use strict";function e(t,e){var i=Object.create(t);for(var n in e)i[n]=e[n];return e.toString!==Object.prototype.toString&&(i.toString=e.toString),i}function i(){}i.__name__=!0,i.remove=function(t,e){var i=t.indexOf(e);return-1!=i&&(t.splice(i,1),!0)},i.now=function(){return Date.now()},Math.__name__=!0;function Ue(){}Ue.__name__=!0,Ue.string=function(t){return c.__string_rec(t,"")},Ue.parseInt=function(t){if(null!=t)for(var e=0,i=t.length;e<i;){var n=e++,r=t.charCodeAt(n);if(r<=8||14<=r&&32!=r&&45!=r){var s=t.charCodeAt(1+n),a=parseInt(t,120==s||88==s?16:10);return isNaN(a)?null:a}}return null};function $e(){}$e.__name__=!0,$e.startsWith=function(t,e){return t.length>=e.length&&0==t.lastIndexOf(e,0)},$e.endsWith=function(t,e){var i=e.length,n=t.length;return i<=n&&t.indexOf(e,n-i)==n-i};function n(t,e,i){Error.call(this,t),this.message=t,this.__previousException=e,this.__nativeException=null!=i?i:this}var s={toFloat:function(t){return t<0?4294967296+t:t+0}};n.__name__=!0,n.thrown=function(t){return t instanceof n?t.get_native():t instanceof Error?t:new a(t)},n.__super__=Error,n.prototype=e(Error.prototype,{get_native:function(){return this.__nativeException}});var a=function(t,e,i){n.call(this,String(t),e,i),this.value=t};a.__name__=!0,a.__super__=n,a.prototype=e(n.prototype,{});var c=function(){};c.__name__=!0,c.__string_rec=function(t,e){if(null==t)return"null";if(5<=e.length)return"<...>";var i,n=typeof t;switch("function"==n&&(t.__name__||t.__ename__)&&(n="object"),n){case"function":return"<function>";case"object":if(t instanceof Array){var r="[";e+="\t";for(var s=0,a=t.length;s<a;){var o=s++;r+=(0<o?",":"")+c.__string_rec(t[o],e)}return r+="]"}try{i=t.toString}catch(s){return"???"}if(null!=i&&i!=Object.toString&&"function"==typeof i){var l=t.toString();if("[object Object]"!=l)return l}r="{\n";e+="\t";var h=null!=t.hasOwnProperty,u=null;for(u in t)h&&!t.hasOwnProperty(u)||"prototype"!=u&&"__class__"!=u&&"__super__"!=u&&"__interfaces__"!=u&&"__properties__"!=u&&(2!=r.length&&(r+=", \n"),r+=e+u+" : "+c.__string_rec(t[u],e));return r+="\n"+(e=e.substring(1))+"}";case"string":return t;default:return String(t)}};function o(){}o.__name__=!0,o.createXMLHttpRequest=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)return new ActiveXObject("Microsoft.XMLHTTP");throw n.thrown("Unable to create XMLHttpRequest object.")};var l=t.Vilog=function(){};l.__name__=!0,l.changeKeyboardMode=function(t){l.keyboardMode!=t&&(l.keyboardMode=t,l.resetFocus())},l.resetFocus=function(){switch(l.keyboardMode){case 0:l.findFocusedPlayer(),l.focusFirst();break;case 1:null!=window.document.activeElement&&"body"==window.document.activeElement.tagName.toLowerCase()?(l.findFocusedPlayer(),l.focusFirst()):(l.focusedPlayer=null,l.findFocusedPlayer());break;case 2:l.focusedPlayer=null,l.findFocusedPlayer();break;case 3:l.focusedPlayer=null,l.lastActiveElement=window.document.activeElement}},l.findFocusedPlayer=function(){for(var t=window.document.activeElement;null!=t;){if(l.players.has(t)){l.focusedPlayer=l.players.get(t);break}t=t.parentElement}l.lastActiveElement=t},l.focusFirst=function(){var t;null!=l.focusedPlayer||null!=(t=l.players.keys().next()).value&&(l.focusedPlayer=l.players.get(t.value))},l.main=function(){l.reload(),window.requestAnimationFrame(l.enterFrame),window.document.addEventListener("keydown",l.onKeyDown)},l.onKeyDown=function(t){if(window.document.activeElement!=l.lastActiveElement&&l.resetFocus(),null!=l.focusedPlayer&&0==t.altKey&&0==t.ctrlKey){var e=!0,i=t.shiftKey;switch(t.keyCode){case 32:0==i?l.focusedPlayer.togglePlay():e=!1;break;case 33:0==i?l.focusedPlayer.step(-l.focusedPlayer.largeStep):e=!1;break;case 34:0==i?l.focusedPlayer.step(l.focusedPlayer.largeStep):e=!1;break;case 35:0==i?l.focusedPlayer.goto(l.focusedPlayer.maxLength):e=!1;break;case 36:0==i?l.focusedPlayer.goto(0):e=!1;break;case 37:0==i?l.focusedPlayer.step(-1):e=!1;break;case 39:0==i?l.focusedPlayer.step(1):e=!1;break;case 65:0==i?l.focusedPlayer.startRewind():e=!1;break;case 68:0==i?l.focusedPlayer.startFastforward():e=!1;break;default:e=!1}e&&t.preventDefault()}},l.onKeyUp=function(t){if(null!=l.focusedPlayer&&0==t.altKey&&0==t.ctrlKey){var e=t.shiftKey;switch(t.keyCode){case 65:0==e&&l.focusedPlayer.finishRewind();break;case 68:0==e&&l.focusedPlayer.finishFastforward()}}},l.reload=function(){for(var t=0,e=window.document.body.getElementsByClassName("vilog");t<e.length;){var i=e[t];++t,l.getImage(i)}for(t=0,e=window.document.body.getElementsByClassName("vilog-player");t<e.length;){i=e[t];++t,l.getPlayer(i)}},l.getImage=function(t){return l.images.has(t)||l.images.set(t,new b(t)),l.images.get(t)},l.getPlayer=function(t){var e;return l.players.has(t)||(e=new d(t),l.players.set(t,e),null==l.focusedPlayer&&l.resetFocus()),l.players.get(t)},l.enterFrame=function(t){var n,r,e=l.lastTime;isNaN(e)||(n=t-l.lastTime,r=0,l.images.forEach(function(t,e,i){l.frame%120!=43*r%120||l.isAlive(e)?t.enterFrame(n):l.images.delete(e),r+=1}),l.players.forEach(function(t,e,i){l.frame%120!=43*r%120||l.isAlive(e)?t.enterFrame(n):(l.players.delete(e),t.removeAllChildren()),r+=1}),l.frame+=1),l.lastTime=t,window.requestAnimationFrame(l.enterFrame)},l.isAlive=function(t){for(;null!=(t=t.parentNode);)if(t==window.document)return!0;return!1};var h=t.VilogArrow=function(t,e,i,n,r,s){this.x=t,this.y=e,this.radius=i,this.corner=n,this.isForward=r,this.angle=s};h.__name__=!0;var v=t.VilogBackground=function(t,e,i,n,r,s){this.lineStyle=r,this.fillStyle=n,this.textStyle=s,this.depth=i,this.end=e,this.start=t};v.__name__=!0;var u=t.VilogConsoleLogger=function(t,e){this.fileName=t,this.logLevel=m.All};u.__name__=!0,u.prototype={setFileName:function(t){this.fileName=t},setLogLevel:function(t){this.logLevel=t},clearBackground:function(){},clear:function(){},log:function(t,e,i,n){if(!(i<this.logLevel))switch(e=this.fileName+":"+t+":"+e,i){case 1:r.console.debug(e);break;case 3:r.console.log(e);break;case 5:r.console.warn(e);break;case 7:r.console.error(e)}}};var g=t.VilogDrawStyle=function(t,e,i,n){this.lineThickness=i,this.lineColor=n,this.fillColor=e,this.kind=t};g.__name__=!0,g.prototype={getFillAlpha:function(){return s.toFloat(this.fillColor>>>24&255)/s.toFloat(255)},getLineAlpha:function(){return s.toFloat(this.lineColor>>>24&255)/s.toFloat(255)},getFillColorString:function(){return this.getColorString(this.fillColor)},getLineColorString:function(){return this.getColorString(this.lineColor)},getColorString:function(t){var e=t>>>16&255,i=t>>>8&255,n=t>>>0&255;return"rgba("+(null==e?"null":Ue.string(s.toFloat(e)))+","+(null==i?"null":Ue.string(s.toFloat(i)))+","+(null==n?"null":Ue.string(s.toFloat(n)))+","+s.toFloat(t>>>24&255)/s.toFloat(255)+")"}};var p=t.VilogElementLogger=function(t,e,i){this.fileName=t,this.logLevel=e,this.container=i,this.background=window.document.createElement("div"),this.background.className="vi-log-back",this.foreground=window.document.createElement("div"),this.foreground.className="vi-log-fore",i.append(this.background),i.append(this.foreground)};p.__name__=!0,p.prototype={setFileName:function(t){this.fileName=t},setLogLevel:function(t){this.logLevel=t},clear:function(){this.foreground.innerHTML=""},clearBackground:function(){this.background.innerHTML=""},log:function(t,e,i,n){if(!(i<this.logLevel)){e=t+":"+e;var r=window.document.createElement("div");switch(i){case 1:r.className="vi-log-trace";break;case 3:r.className="vi-log-info";break;case 5:r.className="vi-log-warn";break;case 7:r.className="vi-log-error"}r.textContent=e,n?this.background.append(r):this.foreground.append(r)}}};var y=t.VilogFrame=function(t,e,i,n,r,s,a,o){this.textStyle=s,this.lineStyle=r,this.fillStyle=n,this.start=t,this.end=e,this.background=a,this.clear=i,this.hasBackgroundUpdate=o,this.backgroundSortedCount=0};y.__name__=!0,y.prototype={setBackground:function(t){this.background=t,this.hasBackgroundUpdate=!0},sortBackground:function(){if(this.hasBackgroundUpdate&&this.backgroundSortedCount!=this.background.size){for(var t=new Map,e=Array.from(this.background.keys()).sort(),i=0;i<e.length;){var n=e[i];++i,t.set(n,this.background.get(n))}this.background=t,this.backgroundSortedCount=this.background.size}},isEmpty:function(){return this.start==this.end}};var b=t.VilogImage=function(t){this.container=t,this.image=window.document.createElement("div"),this.image.className="vi-image",t.prepend(this.image),this.foreground=window.document.createElement("canvas"),this.foreground.width=8,this.foreground.height=8,this.foreground.className="foreground",this.image.prepend(this.foreground),this.foregroundContext=this.foreground.getContext("2d",null),this.foregroundContext.lineJoin="bevel",this.loggers=[],this.fps=NaN,this.fileName="*",this.logLevel=m.All,this.stream=new Ge(this),this.restTime=0,this.playing=!1,this.autoPlay=!t.hasAttribute("data-stop"),this.loop=!t.hasAttribute("data-once");for(var e=0,i=t.getElementsByClassName("vilog-log");e<i.length;){var n=i[e];++e,this.loggers.push(new p(this.fileName,this.logLevel,n))}0==this.loggers.length&&this.loggers.push(new u(this.fileName,this.logLevel)),t.hasAttribute("data-txt")&&this.stream.setContent(t.getAttribute("data-txt")),t.hasAttribute("data-src")&&this.loadFile(t.getAttribute("data-src"))};b.__name__=!0,b.prototype={isLoading:function(){return null!=this.request},addLogger:function(t){this.loggers.push(t)},removeLogger:function(t){return i.remove(this.loggers,t)},play:function(){this.playing||(this.playing=!0)},stop:function(){this.playing&&(this.playing=!1)},enterFrame:function(t){if(this.playing){this.restTime+=t;var e=this.fps;if(!isNaN(e)){for(var i=1e3/this.fps,n=0;i<this.restTime;)++n,this.restTime-=i;0<n&&(this.loop?this.stream.goto((this.stream.currentStep+n)%this.stream.getLength()):this.stream.goto(this.stream.currentStep+n))}}},loadFile:function(t){null!=this.request&&this.request.abort(),this.setFileName(t),this.request=o.createXMLHttpRequest(),this.request.open("GET",t,!0),this.request.onprogress=x(this,this.onLoadFile),this.request.send()},onLoadFile:function(t){var e=t.target.responseText;this.request=null,this.stream.setContent(e),this.container.dispatchEvent(new Event("load"))},setFileName:function(t){this.fileName=t;for(var e=0,i=this.loggers;e<i.length;){var n=i[e];++e,n.setFileName(t)}},setLogLevel:function(t){this.logLevel=t;for(var e=0,i=this.loggers;e<i.length;){var n=i[e];++e,n.setLogLevel(t)}},log:function(t,e,i,n){for(var r=0,s=this.loggers;r<s.length;){var a=s[r];++r,a.log(t,e,i,n)}},initializeCanvas:function(t,e,i){this.foreground.width=Math.ceil(t),this.foreground.height=Math.ceil(e),null!=this.background&&(this.background.width=this.foreground.width,this.background.height=this.foreground.height),this.image.style.width=t+"px",this.image.style.height=e+"px",this.fps=this.container.hasAttribute("data-fps")?parseFloat(this.container.getAttribute("data-fps")):i,this.autoPlay&&this.play()},clear:function(){this.foregroundContext.clearRect(0,0,this.foreground.width,this.foreground.height);for(var t=0,e=this.loggers;t<e.length;){var i=e[t];++t,i.clear()}},clearBackground:function(){null!=this.backgroundContext&&this.backgroundContext.clearRect(0,0,this.background.width,this.background.height);for(var t=0,e=this.loggers;t<e.length;){var i=e[t];++t,i.clearBackground()}},getCanvasContext:function(t){return t?(null==this.backgroundContext&&(this.background=window.document.createElement("canvas"),this.background.width=this.foreground.width,this.background.height=this.foreground.height,this.background.className="background",this.image.prepend(this.background),this.backgroundContext=this.background.getContext("2d",null),this.backgroundContext.lineJoin="bevel"),this.backgroundContext):this.foregroundContext},drawRect:function(t,e,i,n,r,s){var a=this.getCanvasContext(r);this.setStyle(a,s),a.beginPath(),a.rect(t,e,i,n),this.endDraw(a,s)},drawGrid:function(t,e,i,n,r,s,a,o,l){var h=this.getCanvasContext(o);if(this.setStyle(h,l),h.beginPath(),0!=a){for(var u=0,c=r;u<c;)for(var g=u++,p=0,d=s;p<d;){var f=p++;h.rect(t+g*i+a,e+f*n+a,i-2*a,n-2*a)}this.endDraw(h,l)}else{h.rect(t,e,i*r,n*s),this.endDraw(h,l),h.beginPath();for(u=1,c=r;u<c;){g=u++;h.moveTo(t+g*i,e),h.lineTo(t+g*i,e+s*n)}for(u=1,c=s;u<c;){f=u++;h.moveTo(t,e+f*n),h.lineTo(t+r*i,e+f*n)}this.stroke(h,l)}},drawArrows:function(t,e,i){var n=this.getCanvasContext(e);this.setStyle(n,i),n.beginPath();for(var r=0;r<t.length;){var s=t[r];++r;var a=s.radius,o=s.angle+.5*s.corner,l=s.angle-.5*s.corner;n.moveTo(s.x-a*Math.cos(o),s.y-a*Math.sin(o)),n.lineTo(s.x,s.y),n.lineTo(s.x-a*Math.cos(l),s.y-a*Math.sin(l))}this.stroke(n,i)},drawCircle:function(t,e,i,n,r){var s=this.getCanvasContext(n);this.setStyle(s,r),s.beginPath(),s.arc(t,e,i,0,2*Math.PI),this.endDraw(s,r)},startPath:function(t,e,i,n){var r=this.getCanvasContext(i);this.setStyle(r,n),r.beginPath(),r.moveTo(t,e)},lineTo:function(t,e,i){this.getCanvasContext(i).lineTo(t,e)},quadTo:function(t,e,i,n,r){this.getCanvasContext(r).quadraticCurveTo(t,e,i,n)},cubicTo:function(t,e,i,n,r,s,a){this.getCanvasContext(a).bezierCurveTo(t,e,i,n,r,s)},arc:function(t,e,i,n,r,s){var a,o,l=this.getCanvasContext(s),h=n+r;2*-Math.PI<r&&r<2*Math.PI?l.arc(t,e,i,n,h,r<0):(a=t+i*Math.cos(h),o=e+i*Math.sin(h),l.arc(t,e,i,n,n+2*Math.PI),l.moveTo(a,o))},endPath:function(t,e){var i=this.getCanvasContext(t);this.endDraw(i,e)},drawText:function(t,e,i,n,r,s,a){var o=this.getCanvasContext(r);o.textBaseline="top",o.font=a.italic?"italic ":"normal "+a.weight+" "+a.fontSize+"px "+a.fontFamily,this.setStyle(o,s),o.beginPath();for(var l=0,h=a.fontSize,u=t.split(b.newlineRegExp),c=[],g=0;g<u.length;){var p=u[g];++g;var d=o.measureText(p);l<d.width&&(l=d.width),c.push(d.width)}var f=1;n<l&&(f=n/l,l=n,h*=f,o.font=a.fontSize*f+"px "+a.fontFamily+',Meiryo,"MS Gothic",sans-serif'),i-=h*u.length*a.pivotY;for(var m=0,g=0;g<u.length;){p=u[g];++g;var x=e-c[m]*f*a.pivotX;switch(s.kind){case 0:0<s.getFillAlpha()&&o.fillText(p,x,i)}0<s.lineThickness&&0<s.getLineAlpha()&&o.strokeText(p,x,i),i+=h,++m}},endDraw:function(t,e){switch(e.kind){case 0:0<e.getFillAlpha()&&t.fill()}this.stroke(t,e)},stroke:function(t,e){0<e.lineThickness&&0<e.getLineAlpha()&&t.stroke()},setStyle:function(t,e){t.fillStyle=e.getFillColorString(),t.strokeStyle=e.getLineColorString(),t.lineWidth=e.lineThickness}};var d=t.VilogPlayer=function(t){this.rest=0,this.largeStep=10,this.fastforwarding=!1,this.rewinding=!1,this.canPlay=!1,this.playing=!1,this.currentStep=0,this.maxLength=0,-1==(this.container=t).tabIndex&&(t.tabIndex=0),t.addEventListener("blur",x(this,this.onBlur)),this.children=[];for(var e=0,i=t.getElementsByClassName("vilog");e<i.length;){var n=i[e];++e;var r=l.getImage(n);this._addChild(r)}this.footer=window.document.createElement("div"),this.footer.className="vi-row vi-foot",t.append(this.footer),this.rewindButton=this.addButton("vi-small","icon-sb_playback_rewind",x(this,this.onRewind)),this.rewindButton.addEventListener("mouseup",x(this,this.onRewindEnd)),this.rewindButton.title="× -10 (A)",this.playButton=this.addButton("vi-big","icon-sb_playback_play",x(this,this.onPlay)),this.playButton.title="Play/Stop (SPACE)",this.fastforwardButton=this.addButton("vi-small","icon-sb_playback_fastforward",x(this,this.onFastforward)),this.fastforwardButton.addEventListener("mouseup",x(this,this.onFastforwardEnd)),this.fastforwardButton.title="× 10 (D)",this.rangeInput=window.document.createElement("input"),this.rangeInput.className="vi-frame-range",this.rangeInput.type="range",this.rangeInput.min="1",this.rangeInput.max="1",this.rangeInput.value="1",this.rangeInput.step="1",this.rangeInput.addEventListener("input",x(this,this.onRangeInput)),this.footer.append(this.rangeInput),this.backLargeButton=this.addButton("vi-small","icon-sb_arrow_d_left",x(this,this.onBackLarge)),this.backLargeButton.title="-"+this.largeStep+" (Page Up)",this.backSmallButton=this.addButton("vi-small","icon-sb_arrow_s_left",x(this,this.onBackSmall)),this.backSmallButton.title="-1 (←)",this.frameText=window.document.createElement("span"),this.frameText.className="vi-frame-text",this.footer.append(this.frameText),this.foreSmallButton=this.addButton("vi-small","icon-sb_arrow_s_right",x(this,this.onForeSmall)),this.foreSmallButton.title="+1 (→)",this.foreLargeButton=this.addButton("vi-small","icon-sb_arrow_d_right",x(this,this.onForeLarge)),this.foreLargeButton.title="+"+this.largeStep+" (Page Down)",this.refresh()};d.__name__=!0,d.prototype={onRewind:function(t){this.rewinding=!0},onRewindEnd:function(t){this.rewinding=!1},onPlay:function(t){this.togglePlay()},onFastforward:function(t){this.fastforwarding=!0},onFastforwardEnd:function(t){this.fastforwarding=!1},onBackLarge:function(t){this.step(-this.largeStep)},onBackSmall:function(t){this.step(-1)},onForeSmall:function(t){this.step(1)},onForeLarge:function(t){this.step(this.largeStep)},onRangeInput:function(t){this.goto(Math.round(this.rangeInput.valueAsNumber)-1)},togglePlay:function(){this.playing=!this.playing,this.refreshButtons()},addChild:function(t){this._addChild(t),this.refresh()},onChange:function(){this.refresh()},removeChild:function(t){i.remove(this.children,t),t.stream.removeChangeHandler(x(this,this.onChange))},removeAllChildren:function(){for(var t=0,e=this.children;t<e.length;){var i=e[t];++t,i.stream.removeChangeHandler(x(this,this.onChange))}this.children.splice(0,this.children.length)},_addChild:function(t){this.children.push(t),t.autoPlay=!1,t.stop();var e=t.container;e.parentElement==this.container&&(null==this.autoRow&&(this.autoRow=window.document.createElement("div"),this.autoRow.className="vi-row",this.container.prepend(this.autoRow)),this.autoRow.appendChild(e)),t.container.addEventListener("load",x(this,this.refresh)),t.stream.addChangeHandler(x(this,this.onChange))},refresh:function(){for(var t=this.maxLength=0,e=this.children;t<e.length;){var i=e[t];++t;var n=i.stream.getLength();this.maxLength<n&&(this.maxLength=n)}this.maxLength<=this.currentStep&&(this.currentStep=this.maxLength-1),this.goto(this.currentStep),this.canPlay=0<this.children.length;for(t=0,e=this.children;t<e.length;){i=e[t];if(++t,i.isLoading()){this.canPlay=!1;break}}this.refreshButtons()},refreshButtons:function(){this.frameText.textContent=this.currentStep+1+"/"+this.maxLength,this.rangeInput.max=""+this.maxLength,this.rangeInput.value=""+(this.currentStep+1);var t=this.currentStep<=0,e=this.maxLength-1<=this.currentStep;this.rewindButton.disabled=!this.canPlay||t,this.playButton.disabled=!this.canPlay||e,this.fastforwardButton.disabled=!this.canPlay||e,this.rangeInput.disabled=!this.canPlay||t&&e,this.backLargeButton.disabled=!this.canPlay||t,this.backSmallButton.disabled=!this.canPlay||t,this.foreSmallButton.disabled=!this.canPlay||e,this.foreLargeButton.disabled=!this.canPlay||e,this.playButton.firstElementChild.className=this.playing?"icon-sb_playback_suspend":"icon-sb_playback_play"},addButton:function(t,e,i){var n=window.document.createElement("button");return n.className=t,n.innerHTML='<span class="'+e+'"></span></button>',n.disabled=!0,this.footer.append(n),n.addEventListener("mousedown",i),n},enterFrame:function(t){if(0!=this.children.length){var e=this.currentStep,i=1e3/this.children[0].fps;if(this.fastforwarding)this.rest+=10*t;else if(this.rewinding)this.rest+=-10*t;else{if(!this.playing)return;this.rest+=t}for(;i<=this.rest;)++e,this.rest-=i;for(;this.rest<0;)--e,this.rest+=i;e!=this.currentStep&&this.goto(e)}},step:function(t){this.currentStep+=t,this.goto(this.currentStep)},goto:function(t){this.currentStep=t,this.currentStep<0&&(this.currentStep=0,this.rewinding=!1),this.maxLength<=this.currentStep&&(this.currentStep=this.maxLength-1,this.fastforwarding=!1,this.playing=!1);for(var e=0,i=this.children;e<i.length;){var n=i[e];++e,n.stream.goto(t)}this.refreshButtons()},startRewind:function(){this.rewinding=!0,this.fastforwarding=!1},finishRewind:function(){this.rewinding=!1},startFastforward:function(){this.fastforwarding=!0,this.rewinding=!1},finishFastforward:function(){this.fastforwarding=!1},onBlur:function(t){this.fastforwarding=!1,this.rewinding=!1}};var Ge=t.VilogStream=function(t){this.changeHandlers=[],this.output=t,this.frames=[],this.lineIndexs=[],this.backgrounds=new Map,this.currentX=0,this.currentY=0,this.arrows=[],this.arrowsAngle=0,this.arrowsWaiting=!1,this.reset()};Ge.__name__=!0,Ge.prototype={getLength:function(){var t=this.frames.length;return 0<t&&this.frames[t-1].isEmpty()&&--t,t},getLineNumber:function(){return this.lineIndexs.length},reset:function(){this.content="",this.currentStep=0,this.appendContext=0,this.appendBackground=null,this.appendFillStyle=new g(0,-10823449,0,-9923655),this.appendLineStyle=new g(1,0,1,-9472890),this.appendTextStyle=new f("Meiryo",30,700,!1,0,0),this.frames.splice(0,this.frames.length),this.lineIndexs.splice(0,this.lineIndexs.length),this.output.clearBackground(),this.backgrounds.clear(),this.output.clear()},append:function(t){this._append(t),0!=t.length&&this.dispatchChange()},_append:function(t){if(0!=t.length){var e=0==this.frames.length||this.currentStep==this.frames.length-1;this.position=this.content.length,$e.endsWith(t,"\n")||$e.endsWith(t,"\r")||(t+="\n"),this.content+=t;for(var i,n=this.content.length;this.position<n;){Ge.newlineRegExp.lastIndex=this.position;var r=Ge.newlineRegExp.exec(this.content);if(null==r)break;var s=r.index+r[0].length;this.preprocessLine()&&0<this.frames.length&&(this.frames[this.frames.length-1].end=this.getLineNumber()),this.lineIndexs.push(s),this.position=s}e&&(i=this.currentStep,this.currentStep=-1,this.draw(i))}},setContent:function(t){this.reset(),this._append(t),this.dispatchChange()},dispatchChange:function(){for(var t=0,e=this.changeHandlers;t<e.length;){var i=e[t];++t,i()}},addChangeHandler:function(t){this.changeHandlers.push(t)},removeChangeHandler:function(t){i.remove(this.changeHandlers,t)},matchInt:function(t,e){Ge.atomRegExp.lastIndex=0;var i=Ge.atomRegExp.exec(this.content.substring(this.position));null!=i&&(this.position+=i[0].length);var n=null==i||null==i[1]||"_"==i[1]?Ge.emptyString:i[1];if(""==n)return e();var r=Ue.parseInt(n);return null==r?(this.error(t,"`"+n+"` is invalid float."),e()):r},matchFloat:function(t,e){Ge.atomRegExp.lastIndex=0;var i=Ge.atomRegExp.exec(this.content.substring(this.position));null!=i&&(this.position+=i[0].length);var n=null==i||null==i[1]||"_"==i[1]?Ge.emptyString:i[1];if(""==n)return e();var r=parseFloat(n);return isNaN(r)?(this.error(t,"`"+n+"` is invalid float."),e()):r},matchColor:function(t,e){Ge.atomRegExp.lastIndex=0;var i=Ge.atomRegExp.exec(this.content.substring(this.position));null!=i&&(this.position+=i[0].length);var n,r=null==i||null==i[1]||"_"==i[1]?Ge.emptyString:i[1],s=""==r?e():null!=(n=Ge.color8.exec(r))?Ue.parseInt("0x"+n[1]):null!=(n=Ge.color6.exec(r))?-16777216|Ue.parseInt("0x"+n[1]):null!=(n=Ge.color3.exec(r))?-16777216|17*Ue.parseInt("0x"+n[1])<<16|17*Ue.parseInt("0x"+n[2])<<8|17*Ue.parseInt("0x"+n[3]):(this.error(t,"`"+r+"` is invalid color."),e());return s},matchString:function(t,e){var i="",n="";t:for(;this.position<this.content.length;){var r=this.content.charAt(this.position);switch(this.position+=1,r){case"\t":case" ":if(""==n){if(0==i.length)continue;--this.position;break t}i+=r;break;case"\n":case"\r":--this.position;break t;case'"':case"'":if(""==n)0!=i.length&&this.error(t,"invalid `"+n+"` "),n=r;else{if(n==r){var s=this.content.charAt(this.position);switch(s){case"":case"\t":case"\n":case"\r":case" ":case";":break;default:this.error(t,"invalid char `"+s+"`")}return i}i+=r}break;case";":if(""==n){--this.position;break t}i+=r;break;case"\\":var a,o=this.content.charAt(this.position);switch(this.position+=1,o){case'"':a='"';break;case"'":a="'";break;case"0":a="\0";break;case"\\":a="\\";break;case"n":a="\n";break;case"r":a="\r";break;case"t":a="\t";break;default:this.error(t,"invalid char `"+o+"`"),a=""}i+=a;break;default:i+=r}}return""!=n&&this.error(t,"unclosed `"+n+"`"),""==n&&""==i||""==n&&"_"==i?e():i},setArrowsBack:function(t){this.arrowsWaiting&&0<this.arrows.length&&(this.arrows[this.arrows.length-1].angle=t(),this.arrowsWaiting=!1)},endBackground:function(){var t=this.getLineNumber();this.appendBackground.end=t-1,this.backgrounds.set(this.appendBackground.start,this.appendBackground),this.frames[this.frames.length-1].background.get(this.appendBackground.depth).push(this.appendBackground.start),this.appendBackground=null},preprocessLine:function(){var t=this;Ge.atomRegExp.lastIndex=this.position,null!=(f=Ge.atomRegExp.exec(this.content))&&(this.position+=f[0].length);var e=null==f||null==f[1]||"_"==f[1]?Ge.emptyString:f[1];switch(e){case"":return!1;case"background":case"bg":if(1!=this.appendContext)return this.error(this.getLineNumber(),"`"+e+"` is only for body context."),!1;if(null!=this.appendBackground)return this.error(this.getLineNumber(),"Nested `background` is not supported."),!1;var i,n=this.getLineNumber();Ge.atomRegExp.lastIndex=0,null!=(f=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=f[0].length),i=""==(u=null==f||null==f[1]||"_"==f[1]?Ge.emptyString:f[1])?0:null==(o=Ue.parseInt(u))?(this.error(n,"`"+u+"` is invalid float."),0):o;var r=this.getLineNumber()-1;this.appendBackground=new v(r,r,i,this.appendFillStyle,this.appendLineStyle,this.appendTextStyle);var s=new Map,a=this.frames[this.frames.length-1];switch(Ge.atomRegExp.lastIndex=0,null!=(f=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=f[0].length),m=null==f||null==f[1]||"_"==f[1]?Ge.emptyString:f[1]){case"":case"clear":d=!0;break;case"keep":d=!1;break;default:var o=m;this.error(this.getLineNumber(),"Value `"+o+"` is not supported for background.option."),d=!0}a.background.forEach(function(t,e,i){s.set(e,t.slice())}),d&&s.set(i,[]),a.setBackground(s);break;case"canvas":if(0!=this.appendContext)return this.error(this.getLineNumber(),"`"+e+"` is only for header context."),!1;var l,h,u,c,g=this.getLineNumber();Ge.atomRegExp.lastIndex=0,null!=(f=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=f[0].length),l=""==(u=null==f||null==f[1]||"_"==f[1]?Ge.emptyString:f[1])?(t.error(t.getLineNumber(),"canvas.width is required."),100):null==(o=Ue.parseInt(u))?(this.error(g,"`"+u+"` is invalid float."),t.error(t.getLineNumber(),"canvas.width is required."),100):o,Ge.atomRegExp.lastIndex=0,null!=(f=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=f[0].length),h=""==(u=null==f||null==f[1]||"_"==f[1]?Ge.emptyString:f[1])?(t.error(t.getLineNumber(),"canvas.height is required."),100):null==(o=Ue.parseInt(u))?(this.error(g,"`"+u+"` is invalid float."),t.error(t.getLineNumber(),"canvas.height is required."),100):o,Ge.atomRegExp.lastIndex=0,null!=(f=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=f[0].length),c=""==(u=null==f||null==f[1]||"_"==f[1]?Ge.emptyString:f[1])?1.5:(o=parseFloat(u),isNaN(o)?(this.error(g,"`"+u+"` is invalid float."),1.5):o),this.output.initializeCanvas(l,h,c),this.frames.push(new y(g,g,!0,this.appendFillStyle,this.appendLineStyle,this.appendTextStyle,new Map,!1)),this.appendContext=1;break;case"end":if(2==this.appendContext)this.appendContext=1;else{if(null==this.appendBackground)return this.error(this.getLineNumber(),"Nothing to `end`."),!1;var p=this.getLineNumber();this.appendBackground.end=p-1,this.backgrounds.set(this.appendBackground.start,this.appendBackground),this.frames[this.frames.length-1].background.get(this.appendBackground.depth).push(this.appendBackground.start),this.appendBackground=null}break;case"fill_path":case"fp":case"line_path":case"lp":if(1!=this.appendContext)return this.error(this.getLineNumber(),"`"+e+"` is only for body context."),!1;this.appendContext=2;break;case"fill_style":case"fs":this.appendFillStyle=this.readFillStyle(this.getLineNumber(),this.appendContext,e,this.appendFillStyle);break;case"line_style":case"ls":this.appendLineStyle=this.readLineStyle(this.getLineNumber(),this.appendContext,e,this.appendLineStyle);break;case"s":case"step":if(1!=this.appendContext)return this.error(this.getLineNumber(),"`"+e+"` is only for body context."),!1;null!=this.appendBackground&&(this.error(this.getLineNumber(),"`background` is not closed."),p=this.getLineNumber(),this.appendBackground.end=p-1,this.backgrounds.set(this.appendBackground.start,this.appendBackground),this.frames[this.frames.length-1].background.get(this.appendBackground.depth).push(this.appendBackground.start),this.appendBackground=null);var d,f,m,g=this.getLineNumber(),x=this.frames[this.frames.length-1].background;switch(Ge.atomRegExp.lastIndex=0,null!=(f=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=f[0].length),m=null==f||null==f[1]||"_"==f[1]?Ge.emptyString:f[1]){case"":case"clear":d=!0;break;case"keep":d=!1;break;default:o=m;this.error(this.getLineNumber(),"Value `"+o+"` is not supported for step.step_option."),d=!0}this.frames.push(new y(g,g,d,this.appendFillStyle,this.appendLineStyle,this.appendTextStyle,x,!1));break;case"text_style":case"ts":this.appendTextStyle=this.readTextStyle(this.getLineNumber(),this.appendContext,e,this.appendTextStyle)}return!0},readFillStyle:function(t,e,i,n){1!=e&&this.error(t,"`"+i+"` is only for body context."),Ge.atomRegExp.lastIndex=0;var r=Ge.atomRegExp.exec(this.content.substring(this.position));null!=r&&(this.position+=r[0].length);var s,a,o=null==r||null==r[1]||"_"==r[1]?Ge.emptyString:r[1],l=""==o?n.fillColor:null!=(h=Ge.color8.exec(o))?Ue.parseInt("0x"+h[1]):null!=(h=Ge.color6.exec(o))?-16777216|Ue.parseInt("0x"+h[1]):null!=(h=Ge.color3.exec(o))?-16777216|17*Ue.parseInt("0x"+h[1])<<16|17*Ue.parseInt("0x"+h[2])<<8|17*Ue.parseInt("0x"+h[3]):(this.error(t,"`"+o+"` is invalid color."),n.fillColor);Ge.atomRegExp.lastIndex=0,null!=(r=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=r[0].length),a=""==(o=null==r||null==r[1]||"_"==r[1]?Ge.emptyString:r[1])?n.lineThickness:(s=parseFloat(o),isNaN(s)?(this.error(t,"`"+o+"` is invalid float."),n.lineThickness):s),Ge.atomRegExp.lastIndex=0,null!=(r=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=r[0].length);var h,u=""==(o=null==r||null==r[1]||"_"==r[1]?Ge.emptyString:r[1])?n.lineColor:null!=(h=Ge.color8.exec(o))?Ue.parseInt("0x"+h[1]):null!=(h=Ge.color6.exec(o))?-16777216|Ue.parseInt("0x"+h[1]):null!=(h=Ge.color3.exec(o))?-16777216|17*Ue.parseInt("0x"+h[1])<<16|17*Ue.parseInt("0x"+h[2])<<8|17*Ue.parseInt("0x"+h[3]):(this.error(t,"`"+o+"` is invalid color."),n.lineColor);return new g(0,l,a,u)},readLineStyle:function(t,e,i,n){1!=e&&this.error(t,"`"+i+"` is only for body context."),Ge.atomRegExp.lastIndex=0;var r=Ge.atomRegExp.exec(this.content.substring(this.position));null!=r&&(this.position+=r[0].length);var s,a,o=null==r||null==r[1]||"_"==r[1]?Ge.emptyString:r[1];a=""==o?n.lineThickness:(s=parseFloat(o),isNaN(s)?(this.error(t,"`"+o+"` is invalid float."),n.lineThickness):s),Ge.atomRegExp.lastIndex=0,null!=(r=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=r[0].length);var l,h=""==(o=null==r||null==r[1]||"_"==r[1]?Ge.emptyString:r[1])?n.lineColor:null!=(l=Ge.color8.exec(o))?Ue.parseInt("0x"+l[1]):null!=(l=Ge.color6.exec(o))?-16777216|Ue.parseInt("0x"+l[1]):null!=(l=Ge.color3.exec(o))?-16777216|17*Ue.parseInt("0x"+l[1])<<16|17*Ue.parseInt("0x"+l[2])<<8|17*Ue.parseInt("0x"+l[3]):(this.error(t,"`"+o+"` is invalid color."),n.lineColor);return new g(1,0,a,h)},readTextStyle:function(t,e,i,n){1!=e&&this.error(t,"`"+i+"` is only for body context.");var r=this.matchString(t,function(){return n.fontFamily});Ge.atomRegExp.lastIndex=0,null!=(c=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=c[0].length);var s,a,o=null==c||null==c[1]||"_"==c[1]?Ge.emptyString:c[1];a=""==o?n.fontSize:(s=parseFloat(o),isNaN(s)?(this.error(t,"`"+o+"` is invalid float."),n.fontSize):s),Ge.atomRegExp.lastIndex=0,null!=(c=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=c[0].length);var l,h=null==c||null==c[1]||"_"==c[1]?Ge.emptyString:c[1];switch(h){case"":u=n.weight;break;case"bold":u=700;break;case"normal":u=400;break;default:var u=null==(g=Ue.parseInt(c=h))?(this.error(t,"`"+c+"` is invalid value for "+i+".weight"),n.weight):g}switch(Ge.atomRegExp.lastIndex=0,null!=(c=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=c[0].length),h=null==c||null==c[1]||"_"==c[1]?Ge.emptyString:c[1]){case"":l=n.italic;break;case"italic":l=!0;break;case"normal":l=!1;break;default:var c=h;this.error(t,"`"+c+"` is unknown enum value for "+i+".italic"),l=n.italic}switch(Ge.atomRegExp.lastIndex=0,null!=(c=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=c[0].length),h=null==c||null==c[1]||"_"==c[1]?Ge.emptyString:c[1]){case"":p=n.pivotX;break;case"center":p=.5;break;case"left":p=0;break;case"right":p=1;break;default:var c=h,g=parseFloat(c),p=isNaN(g)?(this.error(t,"`"+c+"` is unknown enum value for "+i+".pivotX"),n.pivotX):g}switch(Ge.atomRegExp.lastIndex=0,null!=(c=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=c[0].length),h=null==c||null==c[1]||"_"==c[1]?Ge.emptyString:c[1]){case"":d=n.pivotY;break;case"bottom":d=1;break;case"middle":d=.5;break;case"top":d=0;break;default:var c=h,g=parseFloat(c),d=isNaN(g)?(this.error(t,"`"+c+"` is unknown enum value for "+i+".pivotY"),n.pivotY):g}return new f(r,a,u,l,p,d)},step:function(){this.goto(this.currentStep+1)},goto:function(t){var e=this.getLength();e<=t&&(t=e-1),t<0&&(t=0),0!=e&&this.draw(t)},draw:function(t){if(this.frames.length<=t)this.output.clearBackground();else{var e=this.frames[t];t==this.currentStep||!e.hasBackgroundUpdate&&t-1==this.currentStep||(this.output.clearBackground(),this.drawBackground(t));for(var i=t;i!=this.currentStep&&0<=i&&!this.frames[i].clear;)--i;i==this.currentStep?++i:this.output.clear();for(var n=i,r=t+1;n<r;){n++;this.drawFrame(t)}this.currentStep=t}},drawBackground:function(t){var a=this,e=this.frames[t];e.sortBackground(),e.background.forEach(function(t,e,i){for(var n=0;n<t.length;){var r=t[n];++n;var s=a.backgrounds.get(r);a._draw(s.start+1,s.end,!0,s.fillStyle,s.lineStyle,s.textStyle)}})},drawFrame:function(t){var e=this.frames[t];this._draw(e.start,e.end,!1,e.fillStyle,e.lineStyle,e.textStyle)},_draw:function(t,e,i,n,r,s){for(var a=this,o=1,l=n,h=t;h<e;)if(this.backgrounds.has(h))h=this.backgrounds.get(h).end+1;else{this.position=this.lineIndexs[h],h+=1,Ge.atomRegExp.lastIndex=this.position;var u=Ge.atomRegExp.exec(this.content);null!=u&&(this.position+=u[0].length);var c=[null==u||null==u[1]||"_"==u[1]?Ge.emptyString:u[1]];switch(c[0]){case"":break;case"<":case"arrow_back":this.addArrow(h,o,c[0],!1);break;case">":case"arrow":this.addArrow(h,o,c[0],!0);break;case"a":case"arc":if(2!=o)return void this.error(h,"`"+c[0]+"` is only for path context.");Ge.atomRegExp.lastIndex=0;var g=Ge.atomRegExp.exec(this.content.substring(this.position));null!=g&&(this.position+=g[0].length);var p,d,f=null==g||null==g[1]||"_"==g[1]?Ge.emptyString:g[1];d=""==f?(a.error(h,c[0]+".x is required."),0):(p=parseFloat(f),isNaN(p)?(this.error(h,"`"+f+"` is invalid float."),a.error(h,c[0]+".x is required."),0):p),Ge.atomRegExp.lastIndex=0;var m=Ge.atomRegExp.exec(this.content.substring(this.position));null!=m&&(this.position+=m[0].length);var x,v,y=null==m||null==m[1]||"_"==m[1]?Ge.emptyString:m[1];v=""==y?(a.error(h,c[0]+".y is required."),0):(x=parseFloat(y),isNaN(x)?(this.error(h,"`"+y+"` is invalid float."),a.error(h,c[0]+".y is required."),0):x),Ge.atomRegExp.lastIndex=0;var b=Ge.atomRegExp.exec(this.content.substring(this.position));null!=b&&(this.position+=b[0].length);var w,_=null==b||null==b[1]||"_"==b[1]?Ge.emptyString:b[1],k=(""==_?(a.error(h,c[0]+".x is required."),0):(w=parseFloat(_),isNaN(w)?(this.error(h,"`"+_+"` is invalid float."),a.error(h,c[0]+".x is required."),0):w))/180*Math.PI,S=this.currentX-d,E=this.currentY-v,R=Math.sqrt(S*S+E*E),N=Math.atan2(E,S);this.output.arc(d,v,R,N,k,i),this.arrowsWaiting&&0<this.arrows.length&&(this.arrows[this.arrows.length-1].angle=N+Math.PI/2+(0<=k?Math.PI:0),this.arrowsWaiting=!1);var I=N+k;this.arrowsAngle=I-Math.PI/2+(0<=k?Math.PI:0),this.currentX=d+R*Math.cos(I),this.currentY=v+R*Math.sin(I);break;case"c":case"cubic":if(2!=o)return void this.error(h,"`"+c[0]+"` is only for path context.");Ge.atomRegExp.lastIndex=0;var F=Ge.atomRegExp.exec(this.content.substring(this.position));null!=F&&(this.position+=F[0].length);var C,L,q=null==F||null==F[1]||"_"==F[1]?Ge.emptyString:F[1];L=""==q?(a.error(h,c[0]+".x is required."),0):(C=parseFloat(q),isNaN(C)?(this.error(h,"`"+q+"` is invalid float."),a.error(h,c[0]+".x is required."),0):C),Ge.atomRegExp.lastIndex=0;var B=Ge.atomRegExp.exec(this.content.substring(this.position));null!=B&&(this.position+=B[0].length);var P,T,A=null==B||null==B[1]||"_"==B[1]?Ge.emptyString:B[1];T=""==A?(a.error(h,c[0]+".y is required."),0):(P=parseFloat(A),isNaN(P)?(this.error(h,"`"+A+"` is invalid float."),a.error(h,c[0]+".y is required."),0):P),Ge.atomRegExp.lastIndex=0;var M=Ge.atomRegExp.exec(this.content.substring(this.position));null!=M&&(this.position+=M[0].length);var X,W,H=null==M||null==M[1]||"_"==M[1]?Ge.emptyString:M[1];W=""==H?(a.error(h,c[0]+".x is required."),0):(X=parseFloat(H),isNaN(X)?(this.error(h,"`"+H+"` is invalid float."),a.error(h,c[0]+".x is required."),0):X),Ge.atomRegExp.lastIndex=0;var Y=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Y&&(this.position+=Y[0].length);var D,V,O=null==Y||null==Y[1]||"_"==Y[1]?Ge.emptyString:Y[1];V=""==O?(a.error(h,c[0]+".y is required."),0):(D=parseFloat(O),isNaN(D)?(this.error(h,"`"+O+"` is invalid float."),a.error(h,c[0]+".y is required."),0):D),Ge.atomRegExp.lastIndex=0;var z=Ge.atomRegExp.exec(this.content.substring(this.position));null!=z&&(this.position+=z[0].length);var j,K,U=null==z||null==z[1]||"_"==z[1]?Ge.emptyString:z[1];K=""==U?(a.error(h,c[0]+".x is required."),0):(j=parseFloat(U),isNaN(j)?(this.error(h,"`"+U+"` is invalid float."),a.error(h,c[0]+".x is required."),0):j),Ge.atomRegExp.lastIndex=0;var $=Ge.atomRegExp.exec(this.content.substring(this.position));null!=$&&(this.position+=$[0].length);var G,J,Q=null==$||null==$[1]||"_"==$[1]?Ge.emptyString:$[1];J=""==Q?(a.error(h,c[0]+".y is required."),0):(G=parseFloat(Q),isNaN(G)?(this.error(h,"`"+Q+"` is invalid float."),a.error(h,c[0]+".y is required."),0):G),this.output.cubicTo(L,T,W,V,K,J,i),this.arrowsWaiting&&0<this.arrows.length&&(this.arrows[this.arrows.length-1].angle=Math.atan2(a.currentY-T,a.currentX-L),this.arrowsWaiting=!1),this.arrowsAngle=Math.atan2(J-V,K-W),this.currentX=K,this.currentY=J;break;case"end":2==o?(this.output.endPath(i,l),0<this.arrows.length&&this.output.drawArrows(this.arrows,i,l),o=1):this.error(h,"Nothing to `end`.");break;case"e":case"error":this.log(h,c[0],7,i);break;case"fc":case"fill_circle":case"lc":case"line_circle":if(1!=o)return void this.error(h,"`"+c[0]+"` is only for body context.");Ge.atomRegExp.lastIndex=0;var Z=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Z&&(this.position+=Z[0].length);var tt,et,it=null==Z||null==Z[1]||"_"==Z[1]?Ge.emptyString:Z[1];et=""==it?(a.error(h,c[0]+".x is required."),0):(tt=parseFloat(it),isNaN(tt)?(this.error(h,"`"+it+"` is invalid float."),a.error(h,c[0]+".x is required."),0):tt),Ge.atomRegExp.lastIndex=0;var nt=Ge.atomRegExp.exec(this.content.substring(this.position));null!=nt&&(this.position+=nt[0].length);var rt,st,at=null==nt||null==nt[1]||"_"==nt[1]?Ge.emptyString:nt[1];st=""==at?(a.error(h,c[0]+".y is required."),0):(rt=parseFloat(at),isNaN(rt)?(this.error(h,"`"+at+"` is invalid float."),a.error(h,c[0]+".y is required."),0):rt),Ge.atomRegExp.lastIndex=0;var ot=Ge.atomRegExp.exec(this.content.substring(this.position));null!=ot&&(this.position+=ot[0].length);var lt,ht,ut=null==ot||null==ot[1]||"_"==ot[1]?Ge.emptyString:ot[1];ht=""==ut?(a.error(h,c[0]+".radius is required."),100):(lt=parseFloat(ut),isNaN(lt)?(this.error(h,"`"+ut+"` is invalid float."),a.error(h,c[0]+".radius is required."),100):lt),this.output.drawCircle(et,st,ht,i,$e.startsWith(c[0],"f")?n:r);break;case"fg":case"fill_grid":case"lg":case"line_grid":if(1!=o)return void this.error(h,"`"+c[0]+"` is only for body context.");Ge.atomRegExp.lastIndex=0;var ct=Ge.atomRegExp.exec(this.content.substring(this.position));null!=ct&&(this.position+=ct[0].length);var gt,pt,dt=null==ct||null==ct[1]||"_"==ct[1]?Ge.emptyString:ct[1];pt=""==dt?(a.error(h,c[0]+".x is required."),0):(gt=parseFloat(dt),isNaN(gt)?(this.error(h,"`"+dt+"` is invalid float."),a.error(h,c[0]+".x is required."),0):gt),Ge.atomRegExp.lastIndex=0;var ft=Ge.atomRegExp.exec(this.content.substring(this.position));null!=ft&&(this.position+=ft[0].length);var mt,xt,vt=null==ft||null==ft[1]||"_"==ft[1]?Ge.emptyString:ft[1];xt=""==vt?(a.error(h,c[0]+".y is required."),0):(mt=parseFloat(vt),isNaN(mt)?(this.error(h,"`"+vt+"` is invalid float."),a.error(h,c[0]+".y is required."),0):mt),Ge.atomRegExp.lastIndex=0;var yt=Ge.atomRegExp.exec(this.content.substring(this.position));null!=yt&&(this.position+=yt[0].length);var bt,wt,_t=null==yt||null==yt[1]||"_"==yt[1]?Ge.emptyString:yt[1];wt=""==_t?(a.error(h,c[0]+".cell_width is required."),50):(bt=parseFloat(_t),isNaN(bt)?(this.error(h,"`"+_t+"` is invalid float."),a.error(h,c[0]+".cell_width is required."),50):bt),Ge.atomRegExp.lastIndex=0;var kt=Ge.atomRegExp.exec(this.content.substring(this.position));null!=kt&&(this.position+=kt[0].length);var St,Et,Rt=null==kt||null==kt[1]||"_"==kt[1]?Ge.emptyString:kt[1];Et=""==Rt?(a.error(h,c[0]+".cell_height is required."),50):(St=parseFloat(Rt),isNaN(St)?(this.error(h,"`"+Rt+"` is invalid float."),a.error(h,c[0]+".cell_height is required."),50):St),Ge.atomRegExp.lastIndex=0;var Nt=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Nt&&(this.position+=Nt[0].length);var It,Ft,Ct=null==Nt||null==Nt[1]||"_"==Nt[1]?Ge.emptyString:Nt[1];Ft=""==Ct?(a.error(h,c[0]+".repeat_x is required."),2):null==(It=Ue.parseInt(Ct))?(this.error(h,"`"+Ct+"` is invalid float."),a.error(h,c[0]+".repeat_x is required."),2):It,Ge.atomRegExp.lastIndex=0;var Lt=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Lt&&(this.position+=Lt[0].length);var qt,Bt,Pt=null==Lt||null==Lt[1]||"_"==Lt[1]?Ge.emptyString:Lt[1];Bt=""==Pt?(a.error(h,c[0]+".repeat_y is required."),2):null==(qt=Ue.parseInt(Pt))?(this.error(h,"`"+Pt+"` is invalid float."),a.error(h,c[0]+".repeat_y is required."),2):qt,Ge.atomRegExp.lastIndex=0;var Tt=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Tt&&(this.position+=Tt[0].length);var At,Mt,Xt=null==Tt||null==Tt[1]||"_"==Tt[1]?Ge.emptyString:Tt[1];Mt=""==Xt?0:(At=parseFloat(Xt),isNaN(At)?(this.error(h,"`"+Xt+"` is invalid float."),0):At),this.output.drawGrid(pt,xt,wt,Et,Ft,Bt,Mt,i,$e.startsWith(c[0],"f")?n:r);break;case"fill_path":case"fp":case"line_path":case"lp":if(1!=o)return void this.error(h,"`"+c[0]+"` is only for body context.");Ge.atomRegExp.lastIndex=0;var Wt=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Wt&&(this.position+=Wt[0].length);var Ht,Yt,Dt=null==Wt||null==Wt[1]||"_"==Wt[1]?Ge.emptyString:Wt[1];Yt=""==Dt?(a.error(h,c[0]+".x is required."),0):(Ht=parseFloat(Dt),isNaN(Ht)?(this.error(h,"`"+Dt+"` is invalid float."),a.error(h,c[0]+".x is required."),0):Ht),Ge.atomRegExp.lastIndex=0;var Vt=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Vt&&(this.position+=Vt[0].length);var Ot,zt,jt=null==Vt||null==Vt[1]||"_"==Vt[1]?Ge.emptyString:Vt[1];zt=""==jt?(a.error(h,c[0]+".y is required."),0):(Ot=parseFloat(jt),isNaN(Ot)?(this.error(h,"`"+jt+"` is invalid float."),a.error(h,c[0]+".y is required."),0):Ot),l=$e.startsWith(c[0],"f")?n:r,this.output.startPath(Yt,zt,i,l),this.currentX=Yt,this.currentY=zt,this.arrowsAngle=0,this.arrowsWaiting=!1,0<this.arrows.length&&this.arrows.splice(0,this.arrows.length),o=2;break;case"fill_style":case"fs":n=this.readFillStyle(h,o,c[0],n);break;case"i":case"info":this.log(h,c[0],3,i);break;case"l":case"line":if(2!=o)return void this.error(h,"`"+c[0]+"` is only for path context.");Ge.atomRegExp.lastIndex=0;var Kt=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Kt&&(this.position+=Kt[0].length);var Ut,$t,Gt=null==Kt||null==Kt[1]||"_"==Kt[1]?Ge.emptyString:Kt[1];$t=""==Gt?(a.error(h,c[0]+".x is required."),0):(Ut=parseFloat(Gt),isNaN(Ut)?(this.error(h,"`"+Gt+"` is invalid float."),a.error(h,c[0]+".x is required."),0):Ut),Ge.atomRegExp.lastIndex=0;var Jt=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Jt&&(this.position+=Jt[0].length);var Qt,Zt,te=null==Jt||null==Jt[1]||"_"==Jt[1]?Ge.emptyString:Jt[1];Zt=""==te?(a.error(h,c[0]+".y is required."),0):(Qt=parseFloat(te),isNaN(Qt)?(this.error(h,"`"+te+"` is invalid float."),a.error(h,c[0]+".y is required."),0):Qt),this.output.lineTo($t,Zt,i),this.arrowsWaiting&&0<this.arrows.length&&(this.arrows[this.arrows.length-1].angle=Math.atan2(a.currentY-Zt,a.currentX-$t),this.arrowsWaiting=!1),this.arrowsAngle=Math.atan2(Zt-this.currentY,$t-this.currentX),this.currentX=$t,this.currentY=Zt;break;case"fill_rect":case"fr":case"line_rect":case"lr":if(1!=o)return void this.error(h,"`"+c[0]+"` is only for body context.");Ge.atomRegExp.lastIndex=0;var ee=Ge.atomRegExp.exec(this.content.substring(this.position));null!=ee&&(this.position+=ee[0].length);var ie,ne,re=null==ee||null==ee[1]||"_"==ee[1]?Ge.emptyString:ee[1];ne=""==re?(a.error(h,c[0]+".x is required."),0):(ie=parseFloat(re),isNaN(ie)?(this.error(h,"`"+re+"` is invalid float."),a.error(h,c[0]+".x is required."),0):ie),Ge.atomRegExp.lastIndex=0;var se=Ge.atomRegExp.exec(this.content.substring(this.position));null!=se&&(this.position+=se[0].length);var ae,oe,le=null==se||null==se[1]||"_"==se[1]?Ge.emptyString:se[1];oe=""==le?(a.error(h,c[0]+".y is required."),0):(ae=parseFloat(le),isNaN(ae)?(this.error(h,"`"+le+"` is invalid float."),a.error(h,c[0]+".y is required."),0):ae),Ge.atomRegExp.lastIndex=0;var he=Ge.atomRegExp.exec(this.content.substring(this.position));null!=he&&(this.position+=he[0].length);var ue,ce,ge=null==he||null==he[1]||"_"==he[1]?Ge.emptyString:he[1];ce=""==ge?(a.error(h,c[0]+".width is required."),100):(ue=parseFloat(ge),isNaN(ue)?(this.error(h,"`"+ge+"` is invalid float."),a.error(h,c[0]+".width is required."),100):ue),Ge.atomRegExp.lastIndex=0;var pe=Ge.atomRegExp.exec(this.content.substring(this.position));null!=pe&&(this.position+=pe[0].length);var de,fe,me=null==pe||null==pe[1]||"_"==pe[1]?Ge.emptyString:pe[1];fe=""==me?(a.error(h,c[0]+".height is required."),100):(de=parseFloat(me),isNaN(de)?(this.error(h,"`"+me+"` is invalid float."),a.error(h,c[0]+".height is required."),100):de),this.output.drawRect(ne,oe,ce,fe,i,$e.startsWith(c[0],"f")?n:r);break;case"line_style":case"ls":r=this.readLineStyle(h,o,c[0],r);break;case"fill_text":case"ft":case"line_text":case"lt":if(1!=o)return void this.error(h,"`"+c[0]+"` is only for body context.");var xe=this.matchString(h,function(t){return function(){return a.error(h,t[0]+".text is required."),""}}(c));Ge.atomRegExp.lastIndex=0;var ve=Ge.atomRegExp.exec(this.content.substring(this.position));null!=ve&&(this.position+=ve[0].length);var ye,be,we=null==ve||null==ve[1]||"_"==ve[1]?Ge.emptyString:ve[1];be=""==we?(a.error(h,c[0]+".x is required."),0):(ye=parseFloat(we),isNaN(ye)?(this.error(h,"`"+we+"` is invalid float."),a.error(h,c[0]+".x is required."),0):ye),Ge.atomRegExp.lastIndex=0;var _e=Ge.atomRegExp.exec(this.content.substring(this.position));null!=_e&&(this.position+=_e[0].length);var ke,Se,Ee=null==_e||null==_e[1]||"_"==_e[1]?Ge.emptyString:_e[1];Se=""==Ee?(a.error(h,c[0]+".y is required."),0):(ke=parseFloat(Ee),isNaN(ke)?(this.error(h,"`"+Ee+"` is invalid float."),a.error(h,c[0]+".y is required."),0):ke),Ge.atomRegExp.lastIndex=0;var Re=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Re&&(this.position+=Re[0].length);var Ne,Ie,Fe=null==Re||null==Re[1]||"_"==Re[1]?Ge.emptyString:Re[1];Ie=""==Fe?1/0:(Ne=parseFloat(Fe),isNaN(Ne)?(this.error(h,"`"+Fe+"` is invalid float."),1/0):Ne),this.output.drawText(xe,be,Se,Ie,i,$e.startsWith(c[0],"f")?n:r,s);break;case"q":case"quad":if(2!=o)return void this.error(h,"`"+c[0]+"` is only for path context.");Ge.atomRegExp.lastIndex=0;var Ce=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Ce&&(this.position+=Ce[0].length);var Le,qe,Be=null==Ce||null==Ce[1]||"_"==Ce[1]?Ge.emptyString:Ce[1];qe=""==Be?(a.error(h,c[0]+".x is required."),0):(Le=parseFloat(Be),isNaN(Le)?(this.error(h,"`"+Be+"` is invalid float."),a.error(h,c[0]+".x is required."),0):Le),Ge.atomRegExp.lastIndex=0;var Pe=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Pe&&(this.position+=Pe[0].length);var Te,Ae,Me=null==Pe||null==Pe[1]||"_"==Pe[1]?Ge.emptyString:Pe[1];Ae=""==Me?(a.error(h,c[0]+".y is required."),0):(Te=parseFloat(Me),isNaN(Te)?(this.error(h,"`"+Me+"` is invalid float."),a.error(h,c[0]+".y is required."),0):Te),Ge.atomRegExp.lastIndex=0;var Xe=Ge.atomRegExp.exec(this.content.substring(this.position));null!=Xe&&(this.position+=Xe[0].length);var We,He,Ye=null==Xe||null==Xe[1]||"_"==Xe[1]?Ge.emptyString:Xe[1];He=""==Ye?(a.error(h,c[0]+".x is required."),0):(We=parseFloat(Ye),isNaN(We)?(this.error(h,"`"+Ye+"` is invalid float."),a.error(h,c[0]+".x is required."),0):We),Ge.atomRegExp.lastIndex=0;var De=Ge.atomRegExp.exec(this.content.substring(this.position));null!=De&&(this.position+=De[0].length);var Ve,Oe,ze=null==De||null==De[1]||"_"==De[1]?Ge.emptyString:De[1];Oe=""==ze?(a.error(h,c[0]+".y is required."),0):(Ve=parseFloat(ze),isNaN(Ve)?(this.error(h,"`"+ze+"` is invalid float."),a.error(h,c[0]+".y is required."),0):Ve),this.output.quadTo(qe,Ae,He,Oe,i),this.arrowsWaiting&&0<this.arrows.length&&(this.arrows[this.arrows.length-1].angle=Math.atan2(a.currentY-Ae,a.currentX-qe),this.arrowsWaiting=!1),this.arrowsAngle=Math.atan2(Oe-Ae,He-qe),this.currentX=He,this.currentY=Oe;break;case"t":case"trace":this.log(h,c[0],1,i);break;case"text_style":case"ts":s=this.readTextStyle(h,o,c[0],s);break;case"w":case"warn":this.log(h,c[0],5,i);break;default:this.error(h,"`"+c[0]+"` is unknown command.")}Ge.atomRegExp.lastIndex=0;var je=Ge.atomRegExp.exec(this.content.substring(this.position));null!=je&&(this.position+=je[0].length);var Ke=null==je||null==je[1]||"_"==je[1]?Ge.emptyString:je[1];""!=Ke&&this.error(h,"Too long argument:"+Ke)}},addArrow:function(t,e,i,n){var r,s,a,o,l;2==e?(Ge.atomRegExp.lastIndex=0,null!=(s=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=s[0].length),r=""==(a=null==s||null==s[1]||"_"==s[1]?Ge.emptyString:s[1])?5:(o=parseFloat(a),isNaN(o)?(this.error(t,"`"+a+"` is invalid float."),5):o),Ge.atomRegExp.lastIndex=0,null!=(s=Ge.atomRegExp.exec(this.content.substring(this.position)))&&(this.position+=s[0].length),l=(""==(a=null==s||null==s[1]||"_"==s[1]?Ge.emptyString:s[1])?90:(o=parseFloat(a),isNaN(o)?(this.error(t,"`"+a+"` is invalid float."),90):o))/180*Math.PI,this.arrows.push(new h(this.currentX,this.currentY,r,l,n,n?this.arrowsAngle:Math.PI)),n||(this.arrowsWaiting=!0)):this.error(t,"`"+i+"` is only for path context.")},error:function(t,e){this.output.log(t+1,e,7,!1)},log:function(t,e,i,n){var r=this,s=this.matchString(t,function(){return r.error(t,e+".message is required."),""});this.output.log(t+1,s,i,n)}};var f=t.VilogTextStyle=function(t,e,i,n,r,s){this.italic=n,this.weight=i,this.fontSize=e,this.fontFamily=t,this.pivotX=r,this.pivotY=s};f.__name__=!0;var m=t.VilogLogLevel={};function x(t,e){return null==e?null:(null==e.__id__&&(e.__id__=r.$haxeUID++),null==t.hx__closures__?t.hx__closures__={}:i=t.hx__closures__[e.__id__],null==i&&(i=e.bind(t),t.hx__closures__[e.__id__]=i),i);var i}r.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(i.now=performance.now.bind(performance)),String.__name__=!0,Array.__name__=!0,c.__toStr={}.toString,l.images=new Map,l.players=new Map,l.frame=0,l.keyboardMode=2,b.newlineRegExp=new RegExp("\r\n|\n|\r"),Ge.newlineRegExp=new RegExp("\r\n|\n|\r","g"),Ge.stepRegExp=new RegExp("^[ \t]*step","gm"),Ge.backgroundRegExp=new RegExp("^[ \t]*background","gm"),Ge.atomRegExp=new RegExp("^[ \t]*([^ \t\r\n;]+)|$","gm"),Ge.color8=new RegExp("^#([0-9A-F]{8})$","i"),Ge.color6=new RegExp("^#([0-9A-F]{6})$","i"),Ge.color3=new RegExp("^#([0-9A-F])([0-9A-F])([0-9A-F])$","i"),Ge.emptyString="",m.All=0,m.Off=8,m.Trace=1,m.Info=3,m.Warn=5,m.Error=7,l.main()}("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);